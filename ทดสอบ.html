<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการครุภัณฑ์และพัสดุ - ตามระเบียบ สตง.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
        }
        
        .table-container {
            max-height: 600px;
            overflow: auto;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
        }
        
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        
        .column-header {
            min-width: 120px;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            color: white;
            border-right: 1px solid rgba(255,255,255,0.2);
            white-space: nowrap;
        }
        
        .column-header:last-child {
            border-right: none;
        }
        
        .data-row {
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s ease;
        }
        
        .data-row:hover {
            background-color: #f8fafc;
        }
        
        .data-cell {
            min-width: 120px;
            padding: 10px 8px;
            text-align: center;
            font-size: 13px;
            border-right: 1px solid #f3f4f6;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .data-cell:last-child {
            border-right: none;
        }
        
        .status-active { background-color: #dcfce7; color: #166534; }
        .status-damaged { background-color: #fef2f2; color: #dc2626; }
        .status-repair { background-color: #fef3c7; color: #d97706; }
        
        .form-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .alert-error {
            background-color: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 8px;
        }
        
        .stats-label {
            color: #6b7280;
            font-weight: 500;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: #f3f4f6;
            color: #6b7280;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background: #4f46e5;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 24px;
            background: white;
            border-radius: 0 8px 8px 8px;
            border: 1px solid #e5e7eb;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-indigo-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-indigo-500 p-3 rounded-lg">
                        <i class="fas fa-boxes text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">ระบบจัดการครุภัณฑ์และพัสดุ</h1>
                        <p class="text-gray-600">ตามระเบียบสำนักนายกรัฐมนตรีว่าด้วยการพัสดุ พ.ศ. 2560</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="syncWithSheets()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> ซิงค์ Google Sheets
                    </button>
                    <button onclick="exportToExcel()" class="btn-secondary">
                        <i class="fas fa-download"></i> ส่งออก Excel
                    </button>
                    <button onclick="generateReport()" class="btn-primary">
                        <i class="fas fa-chart-bar"></i> สร้างรายงาน
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Alert Messages -->
        <div id="alertContainer"></div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stats-card">
                <div class="stats-number" id="totalItems">0</div>
                <div class="stats-label">รายการทั้งหมด</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="totalValue">0</div>
                <div class="stats-label">มูลค่ารวม (บาท)</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="activeItems">0</div>
                <div class="stats-label">ใช้งานได้</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="expiredWarranty">0</div>
                <div class="stats-label">ประกันหมดอายุ</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="flex space-x-2">
                <button class="tab-button active" onclick="switchTab('data')">
                    <i class="fas fa-table"></i> ข้อมูลครุภัณฑ์และพัสดุ
                </button>
                <button class="tab-button" onclick="switchTab('add')">
                    <i class="fas fa-plus"></i> เพิ่มรายการใหม่
                </button>
                <button class="tab-button" onclick="switchTab('search')">
                    <i class="fas fa-search"></i> ค้นหาและกรอง
                </button>
                <button class="tab-button" onclick="switchTab('reports')">
                    <i class="fas fa-chart-line"></i> รายงานและสถิติ
                </button>
            </div>
        </div>

        <!-- Data Tab -->
        <div id="dataTab" class="tab-content active">
            <div class="bg-white rounded-lg shadow-lg">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-table text-indigo-500 mr-2"></i>
                            ตารางข้อมูลครุภัณฑ์และพัสดุ (27 คอลัมน์)
                        </h2>
                        <div class="flex items-center space-x-4">
                            <input type="text" id="quickSearch" placeholder="ค้นหาด่วน..." 
                                   class="input-field w-64" onkeyup="quickSearch()">
                            <button onclick="refreshData()" class="btn-secondary">
                                <i class="fas fa-sync-alt"></i> รีเฟรช
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="w-full">
                        <thead class="sticky-header">
                            <tr>
                                <th class="column-header">A<br>รหัสครุภัณฑ์/พัสดุ</th>
                                <th class="column-header">B<br>ชื่อรายการ</th>
                                <th class="column-header">C<br>ประเภท</th>
                                <th class="column-header">D<br>หมวดหมู่ย่อย</th>
                                <th class="column-header">E<br>ยี่ห้อ/รุ่น</th>
                                <th class="column-header">F<br>หมายเลขซีเรียล</th>
                                <th class="column-header">G<br>ราคาต่อหน่วย</th>
                                <th class="column-header">H<br>จำนวน</th>
                                <th class="column-header">I<br>มูลค่ารวม</th>
                                <th class="column-header">J<br>วันที่จัดซื้อ</th>
                                <th class="column-header">K<br>วันที่รับของ</th>
                                <th class="column-header">L<br>แหล่งเงิน</th>
                                <th class="column-header">M<br>เลขที่ใบสั่งซื้อ/สัญญา</th>
                                <th class="column-header">N<br>ผู้จำหน่าย/ผู้รับเหมา</th>
                                <th class="column-header">O<br>หน่วยงาน</th>
                                <th class="column-header">P<br>สถานที่ตั้ง</th>
                                <th class="column-header">Q<br>ผู้รับผิดชอบ</th>
                                <th class="column-header">R<br>สถานะ</th>
                                <th class="column-header">S<br>ระยะเวลาประกัน (เดือน)</th>
                                <th class="column-header">T<br>วันหมดประกัน</th>
                                <th class="column-header">U<br>อัตราค่าเสื่อมราคา (%/ปี)</th>
                                <th class="column-header">V<br>อายุการใช้งาน (ปี)</th>
                                <th class="column-header">W<br>ค่าเสื่อมราคาสะสม</th>
                                <th class="column-header">X<br>ผู้บันทึกข้อมูล</th>
                                <th class="column-header">Y<br>หมายเหตุ</th>
                                <th class="column-header">Z<br>วันที่สร้างข้อมูล</th>
                                <th class="column-header">AA<br>วันที่อัปเดทล่าสุด</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- ข้อมูลจะถูกเพิ่มที่นี่โดย JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add Item Tab -->
        <div id="addTab" class="tab-content">
            <div class="form-section">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-plus-circle text-indigo-500 mr-2"></i>
                    เพิ่มรายการครุภัณฑ์/พัสดุใหม่
                </h2>
                
                <form id="addItemForm" onsubmit="addItem(event)">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- ข้อมูลพื้นฐาน -->
                        <div class="input-group">
                            <label class="input-label">รหัสครุภัณฑ์/พัสดุ *</label>
                            <input type="text" name="code" class="input-field" required 
                                   placeholder="เช่น EQ001, MT001">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ชื่อรายการ *</label>
                            <input type="text" name="name" class="input-field" required 
                                   placeholder="ชื่อครุภัณฑ์/พัสดุ">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ประเภท *</label>
                            <select name="category" class="input-field" required onchange="updateSubcategories()">
                                <option value="">เลือกประเภท</option>
                                <option value="ครุภัณฑ์">ครุภัณฑ์</option>
                                <option value="วัสดุคงทน">วัสดุคงทน</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">หมวดหมู่ย่อย</label>
                            <select name="subcategory" class="input-field" id="subcategorySelect">
                                <option value="">เลือกหมวดหมู่ย่อย</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ยี่ห้อ/รุ่น</label>
                            <input type="text" name="brand" class="input-field" 
                                   placeholder="ยี่ห้อและรุ่นของสินค้า">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">หมายเลขซีเรียล</label>
                            <input type="text" name="serial" class="input-field" 
                                   placeholder="Serial Number">
                        </div>
                        
                        <!-- ข้อมูลราคาและจำนวน -->
                        <div class="input-group">
                            <label class="input-label">ราคาต่อหน่วย (บาท) *</label>
                            <input type="number" name="price" class="input-field" required 
                                   step="0.01" min="0" onchange="calculateTotal()">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">จำนวน *</label>
                            <input type="number" name="quantity" class="input-field" required 
                                   min="1" onchange="calculateTotal()">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">มูลค่ารวม (บาท)</label>
                            <input type="number" name="total" class="input-field" readonly 
                                   style="background-color: #f9fafb;">
                        </div>
                        
                        <!-- ข้อมูลการจัดซื้อ -->
                        <div class="input-group">
                            <label class="input-label">วันที่จัดซื้อ *</label>
                            <input type="date" name="purchaseDate" class="input-field" required>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">วันที่รับของ</label>
                            <input type="date" name="receiveDate" class="input-field">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">แหล่งเงิน</label>
                            <select name="budget" class="input-field">
                                <option value="">เลือกแหล่งเงิน</option>
                                <option value="งบประมาณแผ่นดิน">งบประมาณแผ่นดิน</option>
                                <option value="งบประมาณเงินรายได้">งบประมาณเงินรายได้</option>
                                <option value="เงินบริจาค">เงินบริจาค</option>
                                <option value="เงินช่วยเหลือ">เงินช่วยเหลือ</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">เลขที่ใบสั่งซื้อ/สัญญา</label>
                            <input type="text" name="purchaseOrder" class="input-field" 
                                   placeholder="เลขที่อ้างอิง">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ผู้จำหน่าย/ผู้รับเหมา</label>
                            <input type="text" name="supplier" class="input-field" 
                                   placeholder="ชื่อบริษัท/ร้านค้า">
                        </div>
                        
                        <!-- ข้อมูลการใช้งาน -->
                        <div class="input-group">
                            <label class="input-label">หน่วยงาน *</label>
                            <select name="department" class="input-field" required>
                                <option value="">เลือกหน่วยงาน</option>
                                <option value="งานเทคโนโลยี">งานเทคโนโลยี</option>
                                <option value="งานสำนักงาน">งานสำนักงาน</option>
                                <option value="งานอำนวยการ">งานอำนวยการ</option>
                                <option value="งานการเงิน">งานการเงิน</option>
                                <option value="งานบุคคล">งานบุคคล</option>
                                <option value="งานพัสดุ">งานพัสดุ</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">สถานที่ตั้ง</label>
                            <input type="text" name="location" class="input-field" 
                                   placeholder="ตำแหน่งที่เก็บ">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ผู้รับผิดชอบ</label>
                            <input type="text" name="responsible" class="input-field" 
                                   placeholder="เจ้าหน้าที่ดูแล">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">สถานะ *</label>
                            <select name="status" class="input-field" required>
                                <option value="">เลือกสถานะ</option>
                                <option value="ใช้งานได้">ใช้งานได้</option>
                                <option value="ชำรุด">ชำรุด</option>
                                <option value="ซ่อมแซม">ซ่อมแซม</option>
                                <option value="จำหน่าย">จำหน่าย</option>
                                <option value="สูญหาย">สูญหาย</option>
                            </select>
                        </div>
                        
                        <!-- ข้อมูลประกันและค่าเสื่อมราคา -->
                        <div class="input-group">
                            <label class="input-label">ระยะเวลาประกัน (เดือน)</label>
                            <input type="number" name="warrantyPeriod" class="input-field" 
                                   min="0" onchange="calculateWarrantyExpiry()">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">วันหมดประกัน</label>
                            <input type="date" name="warrantyExpiry" class="input-field" readonly 
                                   style="background-color: #f9fafb;">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">อัตราค่าเสื่อมราคา (%/ปี)</label>
                            <input type="number" name="depreciationRate" class="input-field" 
                                   step="0.1" min="0" max="100">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">อายุการใช้งาน (ปี)</label>
                            <input type="number" name="usefulLife" class="input-field" 
                                   min="0" readonly style="background-color: #f9fafb;">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">ผู้บันทึกข้อมูล *</label>
                            <input type="text" name="recorder" class="input-field" required 
                                   placeholder="ชื่อผู้กรอกข้อมูล">
                        </div>
                        
                        <div class="input-group md:col-span-2">
                            <label class="input-label">หมายเหตุ</label>
                            <textarea name="notes" class="input-field" rows="3" 
                                      placeholder="ข้อมูลเพิ่มเติม"></textarea>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" onclick="clearForm()" class="btn-secondary">
                            <i class="fas fa-times"></i> ล้างข้อมูล
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> บันทึกข้อมูล
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Search Tab -->
        <div id="searchTab" class="tab-content">
            <div class="form-section">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-search text-indigo-500 mr-2"></i>
                    ค้นหาและกรองข้อมูล
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="input-group">
                        <label class="input-label">ค้นหาทั่วไป</label>
                        <input type="text" id="searchGeneral" class="input-field" 
                               placeholder="ค้นหาในทุกฟิลด์">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">ประเภท</label>
                        <select id="searchCategory" class="input-field">
                            <option value="">ทั้งหมด</option>
                            <option value="ครุภัณฑ์">ครุภัณฑ์</option>
                            <option value="วัสดุคงทน">วัสดุคงทน</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">สถานะ</label>
                        <select id="searchStatus" class="input-field">
                            <option value="">ทั้งหมด</option>
                            <option value="ใช้งานได้">ใช้งานได้</option>
                            <option value="ชำรุด">ชำรุด</option>
                            <option value="ซ่อมแซม">ซ่อมแซม</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">หน่วยงาน</label>
                        <select id="searchDepartment" class="input-field">
                            <option value="">ทั้งหมด</option>
                            <option value="งานเทคโนโลยี">งานเทคโนโลยี</option>
                            <option value="งานสำนักงาน">งานสำนักงาน</option>
                            <option value="งานอำนวยการ">งานอำนวยการ</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button onclick="performSearch()" class="btn-primary">
                        <i class="fas fa-search"></i> ค้นหา
                    </button>
                    <button onclick="clearSearch()" class="btn-secondary">
                        <i class="fas fa-times"></i> ล้างการค้นหา
                    </button>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div class="form-section">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-chart-line text-indigo-500 mr-2"></i>
                    รายงานและสถิติ
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="font-bold text-lg mb-4">รายงานสรุปตามประเภท</h3>
                        <canvas id="categoryChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="font-bold text-lg mb-4">รายงานสถานะครุภัณฑ์</h3>
                        <canvas id="statusChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="font-bold text-lg mb-4">รายงานมูลค่าตามหน่วยงาน</h3>
                        <canvas id="departmentChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="font-bold text-lg mb-4">การแจ้งเตือน</h3>
                        <div id="alertsList" class="space-y-2">
                            <!-- การแจ้งเตือนจะถูกเพิ่มที่นี่ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ข้อมูลตัวอย่าง
        let assetData = [
            {
                code: 'EQ001',
                name: 'คอมพิวเตอร์ตั้งโต๊ะ Dell OptiPlex 7090',
                category: 'ครุภัณฑ์',
                subcategory: 'ครุภัณฑ์คอมพิวเตอร์',
                brand: 'Dell OptiPlex 7090',
                serial: 'DL7090001',
                price: 25000,
                quantity: 5,
                total: 125000,
                purchaseDate: '2024-01-15',
                receiveDate: '2024-01-20',
                budget: 'งบประมาณแผ่นดิน',
                purchaseOrder: 'PO-2024-001',
                supplier: 'บริษัท เดลล์ (ประเทศไทย) จำกัด',
                department: 'งานเทคโนโลยี',
                location: 'ห้องคอมพิวเตอร์ ชั้น 2',
                responsible: 'นายสมชาย เทคโนโลยี',
                status: 'ใช้งานได้',
                warrantyPeriod: 36,
                warrantyExpiry: '2027-01-15',
                depreciationRate: 20,
                usefulLife: 5,
                accumulatedDepreciation: 25000,
                recorder: 'นายสมชาย ใจดี',
                notes: 'คอมพิวเตอร์สำหรับงานสำนักงาน พร้อม Monitor',
                createdDate: '2024-01-15',
                updatedDate: '2024-01-15'
            },
            {
                code: 'EQ002',
                name: 'เครื่องพิมพ์เลเซอร์ HP LaserJet Pro M404dn',
                category: 'ครุภัณฑ์',
                subcategory: 'ครุภัณฑ์สำนักงาน',
                brand: 'HP LaserJet Pro M404dn',
                serial: 'HP404001',
                price: 8500,
                quantity: 3,
                total: 25500,
                purchaseDate: '2024-01-20',
                receiveDate: '2024-01-25',
                budget: 'งบประมาณแผ่นดิน',
                purchaseOrder: 'PO-2024-002',
                supplier: 'บริษัท เอชพี (ประเทศไทย) จำกัด',
                department: 'งานสำนักงาน',
                location: 'ห้องเอกสาร ชั้น 1',
                responsible: 'นางสาวมาลี เอกสาร',
                status: 'ใช้งานได้',
                warrantyPeriod: 12,
                warrantyExpiry: '2025-01-20',
                depreciationRate: 10,
                usefulLife: 10,
                accumulatedDepreciation: 2550,
                recorder: 'นางสาวมาลี สวยงาม',
                notes: 'เครื่องพิมพ์สำหรับงานเอกสาร',
                createdDate: '2024-01-20',
                updatedDate: '2024-01-20'
            },
            {
                code: 'MT001',
                name: 'โต๊ะทำงานไม้สัก ขนาด 120x60 ซม.',
                category: 'วัสดุคงทน',
                subcategory: 'เฟอร์นิเจอร์และตกแต่ง',
                brand: 'โรงงานเฟอร์นิเจอร์ไทย',
                serial: 'TBL120001',
                price: 3500,
                quantity: 10,
                total: 35000,
                purchaseDate: '2024-02-01',
                receiveDate: '2024-02-05',
                budget: 'งบประมาณเงินรายได้',
                purchaseOrder: 'PO-2024-003',
                supplier: 'ห้างหุ้นส่วนจำกัด เฟอร์นิเจอร์ไทย',
                department: 'งานอำนวยการ',
                location: 'ห้องทำงาน ชั้น 1-3',
                responsible: 'นายประชา อำนวยการ',
                status: 'ใช้งานได้',
                warrantyPeriod: 12,
                warrantyExpiry: '2025-02-01',
                depreciationRate: 5,
                usefulLife: 20,
                accumulatedDepreciation: 1750,
                recorder: 'นายประชา รักงาน',
                notes: 'โต๊ะทำงานสำหรับพนักงาน',
                createdDate: '2024-02-01',
                updatedDate: '2024-02-01'
            }
        ];

        let filteredData = [...assetData];

        // หมวดหมู่ย่อยตามประเภท
        const subcategories = {
            'ครุภัณฑ์': [
                'ครุภัณฑ์คอมพิวเตอร์',
                'ครุภัณฑ์สำนักงาน',
                'ครุภัณฑ์ยานพาหนะ',
                'ครุภัณฑ์โฆษณาและเผยแพร่',
                'ครุภัณฑ์วิทยาศาสตร์',
                'ครุภัณฑ์การแพทย์',
                'ครุภัณฑ์งานบ้านงานครัว',
                'ครุภัณฑ์ก่อสร้าง',
                'ครุภัณฑ์ไฟฟ้าและวิทยุ'
            ],
            'วัสดุคงทน': [
                'เครื่องใช้สำนักงาน',
                'เฟอร์นิเจอร์และตกแต่ง',
                'เครื่องมือและอุปกรณ์',
                'วัสดุโฆษณาและเผยแพร่',
                'วัสดุคอมพิวเตอร์',
                'วัสดุไฟฟ้าและวิทยุ'
            ]
        };

        // อัตราค่าเสื่อมราคาตามหมวดหมู่
        const depreciationRates = {
            'ครุภัณฑ์คอมพิวเตอร์': 20,
            'ครุภัณฑ์สำนักงาน': 10,
            'ครุภัณฑ์ยานพาหนะ': 20,
            'ครุภัณฑ์โฆษณาและเผยแพร่': 10,
            'ครุภัณฑ์วิทยาศาสตร์': 10,
            'ครุภัณฑ์การแพทย์': 10,
            'ครุภัณฑ์งานบ้านงานครัว': 10,
            'ครุภัณฑ์ก่อสร้าง': 10,
            'ครุภัณฑ์ไฟฟ้าและวิทยุ': 10,
            'เครื่องใช้สำนักงาน': 10,
            'เฟอร์นิเจอร์และตกแต่ง': 5,
            'เครื่องมือและอุปกรณ์': 10,
            'วัสดุโฆษณาและเผยแพร่': 10,
            'วัสดุคอมพิวเตอร์': 20,
            'วัสดุไฟฟ้าและวิทยุ': 10
        };

        // ฟังก์ชันเริ่มต้น
        document.addEventListener('DOMContentLoaded', async function() {
            // โหลดการตั้งค่าก่อน
            await loadSettings();
            
            // ลองโหลดข้อมูลจาก Google Sheets ก่อน
            if (APPS_SCRIPT_URL && APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE') {
                await loadDataFromSheets();
            } else {
                // ใช้ข้อมูลตัวอย่างหาก Google Sheets ยังไม่ได้ตั้งค่า
                loadData();
                updateStatistics();
                showAlert('กำลังใช้ข้อมูลตัวอย่าง - กรุณาตั้งค่า Google Sheets เพื่อใช้งานจริง', 'error');
            }
        });

        // การจัดการ Tabs
        function switchTab(tabName) {
            // ซ่อน tab ทั้งหมด
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ลบ active class จากปุ่มทั้งหมด
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // แสดง tab ที่เลือก
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // เพิ่ม active class ให้ปุ่มที่เลือก
            event.target.classList.add('active');
        }

        // อัปเดทหมวดหมู่ย่อย
        function updateSubcategories() {
            const categorySelect = document.querySelector('select[name="category"]');
            const subcategorySelect = document.getElementById('subcategorySelect');
            const depreciationInput = document.querySelector('input[name="depreciationRate"]');
            const usefulLifeInput = document.querySelector('input[name="usefulLife"]');
            
            const selectedCategory = categorySelect.value;
            
            // ล้างตัวเลือกเดิม
            subcategorySelect.innerHTML = '<option value="">เลือกหมวดหมู่ย่อย</option>';
            
            if (selectedCategory && subcategories[selectedCategory]) {
                subcategories[selectedCategory].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subcategorySelect.appendChild(option);
                });
            }
            
            // อัปเดทอัตราค่าเสื่อมราคาเมื่อเลือกหมวดหมู่ย่อย
            subcategorySelect.addEventListener('change', function() {
                const selectedSub = this.value;
                if (selectedSub && depreciationRates[selectedSub]) {
                    depreciationInput.value = depreciationRates[selectedSub];
                    usefulLifeInput.value = Math.ceil(100 / depreciationRates[selectedSub]);
                }
            });
        }

        // คำนวณมูลค่ารวม
        function calculateTotal() {
            const price = parseFloat(document.querySelector('input[name="price"]').value) || 0;
            const quantity = parseInt(document.querySelector('input[name="quantity"]').value) || 0;
            const total = price * quantity;
            
            document.querySelector('input[name="total"]').value = total;
        }

        // คำนวณวันหมดประกัน
        function calculateWarrantyExpiry() {
            const purchaseDate = document.querySelector('input[name="purchaseDate"]').value;
            const warrantyPeriod = parseInt(document.querySelector('input[name="warrantyPeriod"]').value) || 0;
            
            if (purchaseDate && warrantyPeriod > 0) {
                const purchase = new Date(purchaseDate);
                const expiry = new Date(purchase);
                expiry.setMonth(expiry.getMonth() + warrantyPeriod);
                
                document.querySelector('input[name="warrantyExpiry"]').value = 
                    expiry.toISOString().split('T')[0];
            }
        }

        // เพิ่มรายการใหม่
        async function addItem(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const newItem = {};
            
            // แปลงข้อมูลจากฟอร์ม
            for (let [key, value] of formData.entries()) {
                if (['price', 'quantity', 'total', 'warrantyPeriod', 'depreciationRate', 'usefulLife', 'accumulatedDepreciation'].includes(key)) {
                    newItem[key] = parseFloat(value) || 0;
                } else {
                    newItem[key] = value;
                }
            }
            
            // ตรวจสอบรหัสซ้ำ
            if (assetData.some(item => item.code === newItem.code && item.category === newItem.category)) {
                showAlert('รหัสครุภัณฑ์/พัสดุนี้มีอยู่แล้วในประเภทเดียวกัน', 'error');
                return;
            }
            
            // เพิ่มข้อมูลเพิ่มเติม
            newItem.createdDate = new Date().toISOString().split('T')[0];
            newItem.updatedDate = new Date().toISOString().split('T')[0];
            
            // คำนวณค่าเสื่อมราคาสะสม
            if (newItem.total && newItem.depreciationRate && newItem.purchaseDate) {
                const purchaseDate = new Date(newItem.purchaseDate);
                const now = new Date();
                const yearsUsed = (now - purchaseDate) / (365.25 * 24 * 60 * 60 * 1000);
                
                if (yearsUsed > 0) {
                    newItem.accumulatedDepreciation = Math.min(
                        newItem.total * (newItem.depreciationRate / 100) * yearsUsed,
                        newItem.total
                    );
                }
            }
            
            // บันทึกลง Google Sheets ก่อน
            const saved = await saveToSheets(newItem, 'add');
            
            // เพิ่มลงในข้อมูลท้องถิ่น
            assetData.push(newItem);
            filteredData = [...assetData];
            
            // รีเฟรชการแสดงผล
            loadData();
            updateStatistics();
            
            // แสดงข้อความสำเร็จ
            showAlert('เพิ่มข้อมูลสำเร็จ', 'success');
            
            // ล้างฟอร์ม
            clearForm();
            
            // กลับไปที่แท็บข้อมูล
            switchTab('data');
        }

        // ล้างฟอร์ม
        function clearForm() {
            document.getElementById('addItemForm').reset();
        }

        // โหลดข้อมูลลงตาราง
        function loadData() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'data-row';
                
                // สร้างเซลล์ทั้ง 27 คอลัมน์
                const cells = [
                    item.code || '-',
                    item.name || '-',
                    item.category || '-',
                    item.subcategory || '-',
                    item.brand || '-',
                    item.serial || '-',
                    formatNumber(item.price),
                    item.quantity || '-',
                    formatNumber(item.total),
                    formatDate(item.purchaseDate),
                    formatDate(item.receiveDate),
                    item.budget || '-',
                    item.purchaseOrder || '-',
                    item.supplier || '-',
                    item.department || '-',
                    item.location || '-',
                    item.responsible || '-',
                    formatStatus(item.status),
                    item.warrantyPeriod || '-',
                    formatDate(item.warrantyExpiry),
                    item.depreciationRate ? item.depreciationRate + '%' : '-',
                    item.usefulLife || '-',
                    formatNumber(item.accumulatedDepreciation),
                    item.recorder || '-',
                    item.notes || '-',
                    formatDate(item.createdDate),
                    formatDate(item.updatedDate)
                ];
                
                cells.forEach(cellData => {
                    const cell = document.createElement('td');
                    cell.className = 'data-cell';
                    cell.innerHTML = cellData;
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
        }

        // จัดรูปแบบตัวเลข
        function formatNumber(num) {
            if (!num) return '-';
            return new Intl.NumberFormat('th-TH', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(num);
        }

        // จัดรูปแบบวันที่
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('th-TH');
            } catch {
                return dateStr;
            }
        }

        // จัดรูปแบบสถานะ
        function formatStatus(status) {
            if (!status) return '-';
            
            let className = '';
            switch (status) {
                case 'ใช้งานได้':
                    className = 'status-active';
                    break;
                case 'ชำรุด':
                    className = 'status-damaged';
                    break;
                case 'ซ่อมแซม':
                    className = 'status-repair';
                    break;
                default:
                    className = '';
            }
            
            return `<span class="px-2 py-1 rounded-full text-xs font-medium ${className}">${status}</span>`;
        }

        // อัปเดทสถิติ
        function updateStatistics() {
            const totalItems = assetData.length;
            const totalValue = assetData.reduce((sum, item) => sum + (item.total || 0), 0);
            const activeItems = assetData.filter(item => item.status === 'ใช้งานได้').length;
            
            // นับประกันหมดอายุ
            const now = new Date();
            const expiredWarranty = assetData.filter(item => {
                if (!item.warrantyExpiry) return false;
                const expiryDate = new Date(item.warrantyExpiry);
                return expiryDate < now;
            }).length;
            
            document.getElementById('totalItems').textContent = totalItems.toLocaleString();
            document.getElementById('totalValue').textContent = totalValue.toLocaleString();
            document.getElementById('activeItems').textContent = activeItems.toLocaleString();
            document.getElementById('expiredWarranty').textContent = expiredWarranty.toLocaleString();
        }

        // ค้นหาด่วน
        function quickSearch() {
            const searchTerm = document.getElementById('quickSearch').value.toLowerCase();
            
            if (!searchTerm) {
                filteredData = [...assetData];
            } else {
                filteredData = assetData.filter(item => {
                    return Object.values(item).some(value => 
                        value && value.toString().toLowerCase().includes(searchTerm)
                    );
                });
            }
            
            loadData();
        }

        // ค้นหาขั้นสูง
        function performSearch() {
            const general = document.getElementById('searchGeneral').value.toLowerCase();
            const category = document.getElementById('searchCategory').value;
            const status = document.getElementById('searchStatus').value;
            const department = document.getElementById('searchDepartment').value;
            
            filteredData = assetData.filter(item => {
                let matches = true;
                
                if (general) {
                    matches = matches && Object.values(item).some(value => 
                        value && value.toString().toLowerCase().includes(general)
                    );
                }
                
                if (category) {
                    matches = matches && item.category === category;
                }
                
                if (status) {
                    matches = matches && item.status === status;
                }
                
                if (department) {
                    matches = matches && item.department === department;
                }
                
                return matches;
            });
            
            loadData();
            showAlert(`พบข้อมูล ${filteredData.length} รายการ`, 'success');
        }

        // ล้างการค้นหา
        function clearSearch() {
            document.getElementById('searchGeneral').value = '';
            document.getElementById('searchCategory').value = '';
            document.getElementById('searchStatus').value = '';
            document.getElementById('searchDepartment').value = '';
            
            filteredData = [...assetData];
            loadData();
        }

        // รีเฟรชข้อมูล
        function refreshData() {
            filteredData = [...assetData];
            loadData();
            updateStatistics();
            showAlert('รีเฟรชข้อมูลเรียบร้อย', 'success');
        }

        // ตั้งค่า URL ของ Google Apps Script Web App
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzGTkYx0Qw1MawpNhrFZQ2mhvDzeU1oQ2CmZ_0HDvXq-_RMvDFXJI0dUfP-H2LDWYCO3w/exec';

        // โหลดข้อมูลจาก Google Sheets
        async function loadDataFromSheets() {
            try {
                showAlert('กำลังโหลดข้อมูลจาก Google Sheets...', 'success');
                
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'getAllData'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    assetData = result.data || [];
                    filteredData = [...assetData];
                    loadData();
                    updateStatistics();
                    showAlert('โหลดข้อมูลจาก Google Sheets เรียบร้อย', 'success');
                } else {
                    throw new Error(result.message || 'เกิดข้อผิดพลาดในการโหลดข้อมูล');
                }
            } catch (error) {
                console.error('Error loading data from Sheets:', error);
                showAlert('ไม่สามารถโหลดข้อมูลจาก Google Sheets ได้: ' + error.message, 'error');
                
                // ใช้ข้อมูลจาก localStorage หากมี
                const localData = localStorage.getItem('assetData');
                if (localData) {
                    assetData = JSON.parse(localData);
                    filteredData = [...assetData];
                    loadData();
                    updateStatistics();
                    showAlert('ใช้ข้อมูลสำรองจากเครื่อง', 'success');
                }
            }
        }

        // บันทึกข้อมูลลง Google Sheets
        async function saveToSheets(itemData, action = 'add') {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: action === 'add' ? 'addData' : 'updateData',
                        data: JSON.stringify(itemData)
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('บันทึกข้อมูลลง Google Sheets เรียบร้อย', 'success');
                    return true;
                } else {
                    throw new Error(result.message || 'เกิดข้อผิดพลาดในการบันทึก');
                }
            } catch (error) {
                console.error('Error saving to Sheets:', error);
                showAlert('ไม่สามารถบันทึกลง Google Sheets ได้: ' + error.message, 'error');
                
                // บันทึกลง localStorage เป็นสำรอง
                localStorage.setItem('assetData', JSON.stringify(assetData));
                showAlert('บันทึกข้อมูลสำรองในเครื่องแล้ว', 'success');
                return false;
            }
        }

        // ซิงค์ข้อมูลกับ Google Sheets
        async function syncWithSheets() {
            if (!APPS_SCRIPT_URL || APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE') {
                showAlert('กรุณาตั้งค่า URL ของ Google Apps Script ก่อน', 'error');
                return;
            }
            
            await loadDataFromSheets();
        }

        // ดึงการตั้งค่าจาก Google Sheets
        async function loadSettings() {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        action: 'getSettings'
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    // อัปเดทหน่วยงานใน dropdown
                    const departmentSelects = document.querySelectorAll('select[name="department"], #searchDepartment');
                    departmentSelects.forEach(select => {
                        // เก็บค่าเดิมไว้
                        const currentValue = select.value;
                        
                        // ล้างตัวเลือกเดิม (ยกเว้น option แรก)
                        while (select.children.length > 1) {
                            select.removeChild(select.lastChild);
                        }
                        
                        // เพิ่มหน่วยงานใหม่
                        if (result.data.departments) {
                            result.data.departments.forEach(dept => {
                                const option = document.createElement('option');
                                option.value = dept;
                                option.textContent = dept;
                                select.appendChild(option);
                            });
                        }
                        
                        // คืนค่าเดิม
                        select.value = currentValue;
                    });
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // สร้างรายงาน
        function generateReport() {
            showAlert('กำลังสร้างรายงาน...', 'success');
            
            // สร้างรายงานสรุป
            const report = {
                totalItems: assetData.length,
                totalValue: assetData.reduce((sum, item) => sum + (item.total || 0), 0),
                categoryBreakdown: {},
                statusBreakdown: {},
                departmentBreakdown: {}
            };
            
            // วิเคราะห์ข้อมูลตามประเภท
            assetData.forEach(item => {
                // ตามประเภท
                if (!report.categoryBreakdown[item.category]) {
                    report.categoryBreakdown[item.category] = { count: 0, value: 0 };
                }
                report.categoryBreakdown[item.category].count++;
                report.categoryBreakdown[item.category].value += item.total || 0;
                
                // ตามสถานะ
                if (!report.statusBreakdown[item.status]) {
                    report.statusBreakdown[item.status] = 0;
                }
                report.statusBreakdown[item.status]++;
                
                // ตามหน่วยงาน
                if (item.department) {
                    if (!report.departmentBreakdown[item.department]) {
                        report.departmentBreakdown[item.department] = { count: 0, value: 0 };
                    }
                    report.departmentBreakdown[item.department].count++;
                    report.departmentBreakdown[item.department].value += item.total || 0;
                }
            });
            
            console.log('รายงานสรุป:', report);
            
            setTimeout(() => {
                showAlert('สร้างรายงานเสร็จสิ้น', 'success');
            }, 1000);
        }

        // ส่งออก Excel
        function exportToExcel() {
            showAlert('กำลังเตรียมไฟล์ Excel...', 'success');
            
            // สร้าง CSV content
            const headers = [
                'รหัสครุภัณฑ์/พัสดุ', 'ชื่อรายการ', 'ประเภท', 'หมวดหมู่ย่อย', 'ยี่ห้อ/รุ่น',
                'หมายเลขซีเรียล', 'ราคาต่อหน่วย', 'จำนวน', 'มูลค่ารวม', 'วันที่จัดซื้อ',
                'วันที่รับของ', 'แหล่งเงิน', 'เลขที่ใบสั่งซื้อ/สัญญา', 'ผู้จำหน่าย/ผู้รับเหมา',
                'หน่วยงาน', 'สถานที่ตั้ง', 'ผู้รับผิดชอบ', 'สถานะ', 'ระยะเวลาประกัน (เดือน)',
                'วันหมดประกัน', 'อัตราค่าเสื่อมราคา (%/ปี)', 'อายุการใช้งาน (ปี)', 'ค่าเสื่อมราคาสะสม',
                'ผู้บันทึกข้อมูล', 'หมายเหตุ', 'วันที่สร้างข้อมูล', 'วันที่อัปเดทล่าสุด'
            ];
            
            let csvContent = '\uFEFF' + headers.join(',') + '\n';
            
            filteredData.forEach(item => {
                const row = [
                    item.code || '',
                    `"${item.name || ''}"`,
                    item.category || '',
                    item.subcategory || '',
                    `"${item.brand || ''}"`,
                    item.serial || '',
                    item.price || 0,
                    item.quantity || 0,
                    item.total || 0,
                    item.purchaseDate || '',
                    item.receiveDate || '',
                    item.budget || '',
                    item.purchaseOrder || '',
                    `"${item.supplier || ''}"`,
                    item.department || '',
                    `"${item.location || ''}"`,
                    `"${item.responsible || ''}"`,
                    item.status || '',
                    item.warrantyPeriod || '',
                    item.warrantyExpiry || '',
                    item.depreciationRate || '',
                    item.usefulLife || '',
                    item.accumulatedDepreciation || 0,
                    `"${item.recorder || ''}"`,
                    `"${item.notes || ''}"`,
                    item.createdDate || '',
                    item.updatedDate || ''
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // ดาวน์โหลดไฟล์
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ครุภัณฑ์และพัสดุ_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('ส่งออกไฟล์เรียบร้อย', 'success');
        }

        // แสดงข้อความแจ้งเตือน
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
            alertDiv.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            // ลบข้อความหลัง 5 วินาที
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983134d634082db8',t:'MTc1ODUzNzg2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
